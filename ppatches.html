<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>P-Patches Time Slider (Carrot Icons)</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v3.9.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.9.0/mapbox-gl.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="img/favicon.png">

<style>
  body { margin: 0; padding: 0; }
  #map { width: 100%; height: 90vh; }

  .map-overlay {
      position: absolute;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 4px;
      font-family: Arial, sans-serif;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 10;
      overflow: auto;
  }
  
  #features { top: 20px; left: 20px; width: 300px; }
  #legend { bottom: 150px; left: 20px; width: 180px; font-size: 14px; line-height: 22px; }

  h1 {
      font-size: 21px;
  }

  h2 {
      font-size: 15px;
  }
  
  #slider-container {
      width: 90%;
      margin: 15px auto;
      text-align: center;
  }
  #year-value { font-weight: bold; }

  .legend-key {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 5px;
      border-radius: 50%;
      vertical-align: middle;
  }
</style>
</head>

<body>

<div id="map"></div>

<div class="map-overlay" id="features">
  <h1>Seattle P-Patches Over Time</h1>
    <div id="text-description"><p><i>Hover over a P-Patch (orange carrot)!</i></p></div>
    <p>Hold Ctrl and drag to tilt the map</p>
</div>

<div class="map-overlay" id="legend"></div>

<div id="slider-container">
  <input id="year-slider" type="range" min="1970" max="2025" step="1" value="1970" />
  <div>Showing p-patches established by: <span id="year-value">1970</span></div>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidHdpY2tzMTIiLCJhIjoiY21oY3Q4N3B5MDZ2ajJqcHJ1a2J2MDJndCJ9._kVEEl26EulxbWBVv52oMQ';

// Initialize Map
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/twicks12/cmim4x0i1005g01sqgq5mblfy',
    center: [-122.335, 47.62],
    zoom: 10
});

// Load Layers on Map Load
map.on('load', () => {

    map.addSource('ppatches', {
        type: 'geojson',
        data: { "type": "FeatureCollection", "features": [] }
    });

    // Load carrot icon from GitHub
    map.loadImage(
        'https://raw.githubusercontent.com/twickss/finalproject/main/assets/Carrot.png',
        (error, image) => {
            if (error) throw error;

            map.addImage('carrot-icon', image);

            map.addLayer({
                id: 'ppatches-layer',
                type: 'symbol',
                source: 'ppatches',
                layout: {
                    'icon-image': 'carrot-icon',
                    'icon-size': 0.06,
                    'icon-allow-overlap': true
                }
            });

            // Initial filter
            map.setFilter('ppatches-layer', ['<=', ['get', 'DATE_ESTAB'], 1970]);

            // Load GeoJSON
            loadGeoJSON("https://raw.githubusercontent.com/twickss/finalproject/main/assets/P_Patches.geojson");
        }
    );

    // Legend
    const legend = document.getElementById('legend');
    legend.innerHTML = "<b><h2>Legend</h2></b>";

    // P-Patch
    const ppatchItem = document.createElement('div');
    const img = document.createElement('img');
    img.src = 'https://raw.githubusercontent.com/twickss/finalproject/main/assets/Carrot.png';
    img.style.width = '16px';
    img.style.height = '16px';
    img.style.verticalAlign = 'middle';
    img.style.marginRight = '5px';
    ppatchItem.appendChild(img);
    ppatchItem.appendChild(document.createTextNode('P-Patch'));
    legend.appendChild(ppatchItem);
});

// Hover popup
map.on('mousemove', ({ point }) => {
    const features = map.queryRenderedFeatures(point, { layers: ['ppatches-layer'] });
    document.getElementById('text-description').innerHTML = features.length ?
        `<h3>Name: <em>${features[0].properties.NAME}</em></h3>
            <p><strong>Address: <em>${features[0].properties.ADDRESS}</em></strong></p>` :
        `<p><i>Hover over a P-Patch (orange carrot)!</i></p>`;
});

// Load GeoJSON from URL
async function loadGeoJSON(url) {
    try {
        const response = await fetch(url);
        const data = await response.json();
        map.getSource('ppatches').setData(data);
        console.log("Loaded dataset:", data);
    } catch (err) {
        console.error("Failed to load GeoJSON:", err);
    }
}

// Slider behavior
const slider = document.getElementById('year-slider');
const yearValue = document.getElementById('year-value');

slider.addEventListener('input', (e) => {
    const year = parseInt(e.target.value);
    yearValue.textContent = year;

    map.setFilter('ppatches-layer', [
        "<=",
        ["get", "DATE_ESTAB"],
        year
    ]);
});
</script>

</body>
</html>




